
# 地图服务器参数（静态地图加载）
map_server:
  ros__parameters:
    use_sim_time: true
    yaml_filename: "map/map.yaml"   # 地图配置文件路径

# 地图保存服务
map_saver:
  ros__parameters:
    use_sim_time: true
    save_map_timeout: 5.0           # 保存地图的超时时间
    free_thresh_default: 0.25       # 空闲区域阈值
    occupied_thresh_default: 0.65   # 占用区域阈值
    map_subscribe_transient_local: true
    save_map_topic: "map"           # 地图话题名

# 全局路径规划器（planner_server）
planner_server:
  ros__parameters:
    expected_planner_frequency: 20.0        # 规划器频率（Hz）
    use_sim_time: true
    planner_plugins: ["GridBased"]          # 使用的规划器插件列表
    GridBased:
      plugin: "nav2_navfn_planner/NavfnPlanner"  # 插件类型（Dijkstra）
      tolerance: 0.5                        # 到达目标点的容差（米）
      use_astar: false                      # 是否使用 A* 算法（false = Dijkstra）
      allow_unknown: true                   # 允许在未知区域中规划路径

# 控制器服务器（用于本地轨迹跟踪）
controller_server:
  ros__parameters:
    use_sim_time: true
    controller_frequency: 20.0              # 控制器运行频率（Hz）
    min_x_velocity_threshold: 0.001         # 最小 X 方向速度阈值
    min_y_velocity_threshold: 0.001         # 最小 Y 方向速度阈值
    controller_plugins: ["FollowPath"]      # 使用的控制器插件
    FollowPath:
      plugin: "nav2_regulated_pure_pursuit_controller/RegulatedPurePursuitController"  # 控制器插件名
      desired_linear_vel: 0.5               # 期望线速度
      lookahead_dist: 0.6                   # 纯跟踪法中的前视距离
      max_angular_vel: 1.0                  # 最大角速度
      use_velocity_scaled_lookahead_dist: true
      transform_tolerance: 0.2

# 回避恢复行为插件（行为树使用）
behavior_server:
  ros__parameters:
    use_sim_time: true
    behavior_plugins: ["Spin", "BackUp", "Wait"]
    Spin:
      plugin: "nav2_behaviors/Spin"
    BackUp:
      plugin: "nav2_behaviors/BackUp"
    Wait:
      plugin: "nav2_behaviors/Wait"

# 控制器恢复行为（例如机器人在障碍物中时）
recovery_server:
  ros__parameters:
    use_sim_time: true
    recovery_plugins: ["spin", "backup", "wait"]
    spin:
      plugin: "nav2_recoveries/Spin"
    backup:
      plugin: "nav2_recoveries/BackUp"
    wait:
      plugin: "nav2_recoveries/Wait"

# 生命周期管理器
lifecycle_manager:
  ros__parameters:
    use_sim_time: true
    autostart: true
    node_names:
      - map_server
      - amcl
      - planner_server
      - controller_server
      - recovery_server
      - behavior_server
#全局地图  
local_costmap:
  local_costmap:
    ros__parameters:
      robot_radius: 0.12
#代价地图    
global_costmap:
  global_costmap:
    ros__parameters:
      robot_radius: 0.12

global_costmap:
  global_costmap:
    ros__parameters:
      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]
      inflation_layer:
        plugin: "nav2_costmap_2d::InflationLayer"
        cost_scaling_factor: 3.0
        inflation_radius: 0.55